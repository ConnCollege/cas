function checkNum(a){var b=$("."+a+"-LISTED:visible").length;return b}function totalAllowed(a){return"PARENT"==a?5:6}function entryCheck(){checkNum("PARENT")>=totalAllowed("PARENT")?disableModalEnter("PARENT"):enableModalEnter("PARENT"),checkNum("CONTACT")>=totalAllowed("CONTACT")?disableModalEnter("CONTACT"):enableModalEnter("CONTACT")}function disableModalEnter(a){$("#ADD_"+a).attr("disabled","disabled"),$("#"+a+"_MAX_ENTERED").show()}function enableModalEnter(a){$("#ADD_"+a).removeAttr("disabled","disabled"),$("#"+a+"_MAX_ENTERED").hide()}function showDeleteModal(a,b,c){$("#DELETE_MODAL").modal(),$("#delete_form").find("#type").html(a.toLowerCase()),$("#delete_form").find(".name_block").html(c),$("#delete_form").find("#ppid_to_delete").val(b),$("#delete_form").find("#type_to_delete").val(a),"PARENT"==a&&$("#delete_form").find("#note").html("Please Note: this will also remove this parent from your emergency contacts if applicable")}function deleteIndividual(){ppid_to_delete=$("#delete_form #ppid_to_delete").val(),type=$("#delete_form  #type_to_delete").val(),(type="PARENT")?(performDelete(ppid_to_delete,"PARENT"),performDelete(ppid_to_delete,"CONTACT")):performDelete(ppid_to_delete,type)}function alertNumberReview(a){var b=5,c=$(a).val();$("input[name='fields[25]']:checked").length;$("input[name='fields[25]']:checked").length>b?($(a).prop("checked",!1),$("#ALERT_NUMBER_MODAL").modal()):$(a).is(":checked")?$.inArray(c,checked_phone_numbers)==-1&&checked_phone_numbers.push(c):$.inArray(c,checked_phone_numbers)!=-1&&checked_phone_numbers.splice($.inArray(c,checked_phone_numbers),1)}function performDelete(a,b){return $.ajax({type:"POST",url:ajaxurl,data:JSON.stringify({PIDM:student_PIDM,PPID:a,DATA:b,MODE:"DELETE"}),datatype:"json",contentType:"application/json",success:function(c){$(".parent-bootstrap-switch:checked").length;$("#DELETE_MODAL").modal("hide"),"CONTACT"==b?$("#emr_contact_"+a).remove():$("#parent_"+a).remove(),getAlertNumbers(),setEmrOrder(),entryCheck()},error:function(a,b,c){}}),!1}function countryProvinceDisplay(a,b){var c="#GROUP_"+a+"_INTL_REGION",d=c+" #"+a+"_ADDR_PROV_REGION",e="#GROUP_"+a+"_ADDR_STAT_CODE",f=e+" #"+a+"_ADDR_STAT_CODE",g="#GROUP_"+a+"_ADDR_CITY",h="#GROUP_"+a+"_ADDR_ZIP",i="#"+a+"_ADDR_ZIP";"United States"==b||"US"==b?($(e).show(),$(f).addClass("ccreq"),$(f).removeProp("disabled"),$(i).addClass("ccreq"),$(h).show(),$(h+" .required").show(),$(g+" .city").html("City"),$(c).hide(),$(d).prop("disabled","disabled")):"Canada"==b||"CA"==b?($(e).hide(),$(f).removeClass("ccreq"),$(f).prop("disabled","disabled"),$(i).addClass("ccreq"),$(h).show(),$(h+" .required").show(),$(g+" .city").html("City"),$(c).show(),$(d).removeProp("disabled")):($(e).hide(),$(f).removeClass("ccreq"),$(f).prop("disabled","disabled"),$(i).removeClass("ccreq"),$(i).val(""),$(h).hide(),$(h+" .required").hide(),$(g+" .city").html("Postal Code & City"),$(c).show(),$(d).removeProp("disabled"))}function formValidate(a){showMainError=0,$(".alert").hide(),$("#"+a+" input").each(function(){var a=/(<([^>]+)>)/gi,b=$(this).val(),c=b.replace(a,"");$(this).val(c)}),$("#"+a+" .ccreq:visible").each(function(){var a=$(this).val(),b=$(this).attr("id"),d=($(this).attr("type"),$(this).attr("placeholder"));0==a.trim().length?($("#"+b+"_ERROR .custom-error").html("Please Enter "+d),$("#"+b+"_ERROR").show(),$("#group_"+b).addClass("has-error"),showMainError=1):($("#"+b+"_ERROR").hide(),$("#group_"+b).removeClass("has-error"))}),$("#"+a+" input[type=email]").each(function(){var a=$(this).val(),b=$(this).attr("id");if($("#"+b).hasClass("ccreq")||0!=a.length){var d=($(this).attr("type"),$(this).attr("placeholder")),e=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;valid_email=e.test(a),valid_email?"STUDENT_EMAIL_ADDRESS"==b&&a.indexOf("@conncoll")>=0?($("#"+b+"_ERROR .custom-error").html("Please do not enter your @conncoll email address for your "+d+". Please use a non-college email account."),$("#"+b+"_ERROR").show(),$("#group_"+b).addClass("has-error"),showMainError=1):$("#group_"+b).removeClass("has-error"):($("#"+b+"_ERROR .custom-error").html("The "+d+" you entered is invalid. Please enter a valid "+d),$("#"+b+"_ERROR").show(),$("#group_"+b).addClass("has-error"),showMainError=1)}else"STUDENT_EMAIL_ADDRESS"==b&&a.indexOf("@conncoll")>=0?($("#"+b+"_ERROR .custom-error").html("Please do not enter your @conncoll email address for your "+d+". Please use a non-college email account."),$("#"+b+"_ERROR").show(),$("#group_"+b).addClass("has-error"),showMainError=1):$("#group_"+b).removeClass("has-error")}),$("#"+a+" input[type=tel]:visible").each(function(){var a=$(this).val(),b=$(this).attr("id"),d=($(this).attr("type"),$(this).attr("placeholder")),e=$(this).attr("size");a.length!=e&&a.length>0||0==a.length&&$(this).hasClass("ccreq")?($("#"+b+"_ERROR .custom-error").html("The "+d+" you entered is the incorrect length. Please enter a valid "+d),$("#"+b+"_ERROR").show(),$("#group_"+b).addClass("has-error"),showMainError=1):($("#"+b+"_ERROR").hide(),$("#group_"+b).removeClass("has-error"))});var b=/[^\w\s\.\d\t\r\@\,x16\-\#\'\:\+\(\)\\\//]/,c=/[^\w\s\.\d\t\r\,x16\-\']/;$("#"+a+" input:visible").each(function(){var a=$(this).val(),d=$(this).attr("id"),e=$(this).attr("placeholder");if($(this).hasClass("num_only")||"email"==$(this).attr("type"));else if($(this).hasClass("address_field")||$(this).hasClass("intl_number"))if(b.test(a))$("#"+d+"_ERROR .custom-error").html("The"+e+" you entered has foreign or special characters. Please enter Latin characters only."),$("#"+d+"_ERROR").show(),$("#group_"+d).addClass("has-error"),showMainError=1;else{var f=$("#"+d+"_ERROR .custom-error").html();"undefined"!=typeof f&&f.indexOf("foreign")>=0&&($("#"+d+"_ERROR").hide(),$("#group_"+d).removeClass("has-error"))}else if(c.test(a))$("#"+d+"_ERROR .custom-error").html("The"+e+" you entered has foreign or special characters. Please enter Latin characters only."),$("#"+d+"_ERROR").show(),$("#group_"+d).addClass("has-error"),showMainError=1;else{var f=$("#"+d+"_ERROR .custom-error").html();"undefined"!=typeof f&&f.indexOf("foreign")>=0&&($("#"+d+"_ERROR").hide(),$("#group_"+d).removeClass("has-error"))}});var d=$("#"+a+"_ADDR_STREET_LINE1").val(),e=$("#"+a+"_ADDR_CITY").val();if(d.indexOf("270 Mohegan Ave")!=-1&&e.indexOf("New London")!=-1&&($("#"+a+"_CAMPUS_ADDR_ERROR").html("Please do not enter your campus address").show(),showMainError=1),"STUDENT"==a&&0==duplicate&&(0==checkNum("PARENT")?($("#PARENT_NUM_ERROR").show(),showMainError=1):$("#PARENT_NUM_ERROR").hide(),0==checkNum("CONTACT")?($("#CONTACT_NUM_ERROR").show(),showMainError=1):$("#CONTACT_NUM_ERROR").hide()),"PARENT"==a||"CONTACT"==a){var f=1,g=1;if($("#"+a+"_EMERG_NO_CELL_PHONE").is(":checked")){if($("#"+a+"_PHONE_MA_NUMBER_INTL").is(":visible")){if(0==$("#"+a+"_PHONE_MA_NUMBER_INTL").val().length)var f=0}else if(0==$("#"+a+"_PHONE_MA_AREA_CODE").val().length||0==$("#"+a+"_PHONE_MA_NUMBER").val().length)var f=0;if($("#"+a+"_PHONE_BU_NUMBER_INTL").is(":visible")){if(0==$("#"+a+"_PHONE_BU_NUMBER_INTL").val().length)var g=0}else if(0==$("#"+a+"_PHONE_BU_AREA_CODE").val().length||0==$("#"+a+"_PHONE_BU_NUMBER").val().length)var g=0;0==f&&0==g?(showMainError=1,$("#"+a+"_HOME_PHONE_OFFICE_PHONE_ERROR").show()):$("#"+a+"_HOME_PHONE_OFFICE_PHONE_ERROR").hide()}var h=$("#"+a+"_LEGAL_PREFIX_NAME").val(),i=/(?!^\d+$)^.+$/;valid_prefix=i.test(h),"mr"==h.toLowerCase().substring(0,2)||"ms"==h.toLowerCase().substring(0,2)?($("#"+a+"_LEGAL_PREFIX_NAME_ERROR .custom-error").html("Please do not enter Mr., Mrs. or Ms. in the prefix field. Examples of valid prefixes include Attny., Rev., Dr. etc."),$("#"+a+"_LEGAL_PREFIX_NAME_ERROR").show(),$("#group"+a+"_LEGAL_PREFIX_NAME").addClass("has-error"),showMainError=1):valid_prefix||0==h.length?($("#"+a+"_LEGAL_PREFIX_NAME_ERROR").hide(),$("#group"+a+"_LEGAL_PREFIX_NAME").removeClass("has-error")):($("#"+a+"_LEGAL_PREFIX_NAME_ERROR .custom-error").html("This is not a valid prefix. Examples of valid prefixes include Attny., Rev., Dr., etc."),$("#"+a+"_LEGAL_PREFIX_NAME_ERROR").show(),$("#group"+a+"_LEGAL_PREFIX_NAME").addClass("has-error"),showMainError=1);var j=$("#"+a+"_LEGAL_SUFFIX_NAME").val(),k=/(?!^\d+$)^.+$/;valid_suffix=k.test(j),valid_suffix||0==j.length?($("#"+a+"_LEGAL_SUFFIX_NAME_ERROR").hide(),$("#group"+a+"_LEGAL_SUFFIX_NAME").removeClass("has-error")):($("#"+a+"_LEGAL_SUFFIX_NAME_ERROR .custom-error").html("This is not a valid suffix. Examples of valid suffixes include Jr., Sr., IV, etc."),$("#"+a+"_LEGAL_SUFFIX_NAME_ERROR").show(),$("#group"+a+"_LEGAL_SUFFIX_NAME").addClass("has-error"),showMainError=1)}}function submitMainForm(a){return formValidate(a),showMainError?(window.scrollTo(0,0),$("#"+a+"_MODAL").animate({scrollTop:0},"fast"),$("#STUDENT_FORM_ERROR").show(),!1):($("#STUDENT_FORM_ERROR").hide(),!0)}function populateModal(a,b){$.ajax({type:"POST",url:ajaxurl,data:JSON.stringify({PIDM:student_PIDM,PPID:b,DATA:a,MODE:"READ"}),datatype:"json",contentType:"application/json",success:function(c){$("#"+a+"_STUDENT_PIDM").val(student_PIDM),$("#"+a+"_PARENT_PPID").val(b);var d=0;for("PARENT"==a?$.each(c.parent,function(b,c){if($("form#"+a+" #"+b).val(c),"EMERG_NO_CELL_PHONE"==b){if("Y"==c){$(".modal_mobile_phone_check").prop("checked",!0).change();emergencyNumberToggle(a,1)}}else"PARENT_PIDM"==b?$.isNumeric(c)&&($("."+a+"_NAME_FIELD").prop("disabled",!0),$("#"+a+"_NAME_FIELD_NOTE").show()):($("."+a+"_NAME_FIELD").prop("disabled",!1),$("."+a+"_NAME_FIELD_NOTE").hide())}):$.each(c.contact,function(b,c){var d=b,d=d.replace("EMERG","CONTACT");if($("form#"+a+" #"+d).val(c),"EMERG_NO_CELL_PHONE"==b){if("Y"==c){$(".modal_mobile_phone_check").prop("checked",!0).change();emergencyNumberToggle(a,1)}}else"PARENT_PIDM"==b?$.isNumeric(c)&&($("."+a+"_NAME_FIELD").prop("disabled",!0),$("#"+a+"_NAME_FIELD_NOTE").show()):($("."+a+"_NAME_FIELD").prop("disabled",!1),$("#"+a+"_NAME_FIELD_NOTE").hide())}),$.each(c.email,function(b,c){$("form#"+a+" #"+a+"_"+b).val(c)}),$.each(c.address,function(b,d){"ADDR_NATN_CODE"==b&&null==d?$("form#"+a+" #"+a+"_"+b).val("US"):"ADDR_NATN_CODE"==b&&"US"!=d?(countryProvinceDisplay(a,c.address.ADDR_NATN_CODE),$("form#"+a+" #"+a+"_"+b).val(d),$("form#"+a+" #"+a+"_ADDR_PROV_REGION").val(c.address.ADDR_STAT_CODE)):$("form#"+a+" #"+a+"_"+b).val(d)}),""==$("#STUDENT_ADDR_STREET_LINE1").val()&&$("form#"+a+" #GROUP_"+a+"_ADDRESS_TO_USE").hide(),i=0;i<c.phones.length;i++)$("#"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_CODE").val(c.phones[i].PHONE_CODE),"EP"==c.phones[i].PHONE_CODE?(d=1)&&(""!=c.phones[i].PHONE_NUMBER_INTL&&null!=c.phones[i].PHONE_NUMBER_INTL?($("#GROUP_"+a+"_PHONE_EMERGENCY_NUMBER").hide(),$("#"+a+"_PHONE_EMERGENCY_NUMBER_INTL").val(c.phones[i].PHONE_NUMBER_INTL),$("#GROUP_"+a+"_PHONE_EMERGENCY_NUMBER_INTL").show(),$("#"+a+"_PHONE_EMERGENCY_NUMBER_INTL").addClass("ccreq"),$("#"+a+"_PHONE_EMERGENCY_AREA_CODE").removeClass("ccreq"),$("#"+a+"_PHONE_EMERGENCY_NUMBER").removeClass("ccreq"),$("#GROUP_"+a+"_PHONE_EMERGENCY_NUMBER_INTL_SWITCH .intl_number_switch").html("Enter U.S. Number")):($("#GROUP_"+a+"_PHONE_EMERGENCY_NUMBER_INTL").hide(),$("#"+a+"_PHONE_EMERGENCY_AREA_CODE").val(c.phones[i].PHONE_AREA_CODE),$("#"+a+"_PHONE_EMERGENCY_NUMBER").val(c.phones[i].PHONE_NUMBER),$("#GROUP_"+a+"_PHONE_EMERGENCY_NUMBER").show(),$("#"+a+"_PHONE_EMERGENCY_NUMBER_INTL").removeClass("ccreq"),$("#"+a+"_PHONE_EMERGENCY_AREA_CODE").addClass("ccreq"),$("#"+a+"_PHONE_EMERGENCY_NUMBER").addClass("ccreq"),$("#GROUP_"+a+"_PHONE_EMERGENCY_NUMBER_INTL_SWITCH .intl_number_switch").html("Enter International Number"))):"CP"==c.phones[i].PHONE_CODE?""!=c.phones[i].PHONE_NUMBER_INTL&&null!=c.phones[i].PHONE_NUMBER_INTL?($("#GROUP_"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER").hide(),$("#"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER_INTL").val(c.phones[i].PHONE_NUMBER_INTL),$("#"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_AREA_CODE").removeClass("ccreq"),$("#"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER").removeClass("ccreq"),$("#GROUP_"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER_INTL").show(),$("#GROUP_"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER_INTL_SWITCH .intl_number_switch").html("Enter U.S. Number")):($("#"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_AREA_CODE").val(c.phones[i].PHONE_AREA_CODE),$("#GROUP_"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER_INTL").hide(),$("#"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER").val(c.phones[i].PHONE_NUMBER),$("#"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_AREA_CODE").addClass("ccreq"),$("#"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER").addClass("ccreq"),$("#GROUP_"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER").show(),$("#GROUP_"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER_INTL_SWITCH .intl_number_switch").html("Enter International Number")):""!=c.phones[i].PHONE_NUMBER_INTL&&null!=c.phones[i].PHONE_NUMBER_INTL?($("#GROUP_"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER").hide(),$("#"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER_INTL").val(c.phones[i].PHONE_NUMBER_INTL),$("#GROUP_"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER_INTL").show(),$("#GROUP_"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER_INTL_SWITCH .intl_number_switch").html("Enter U.S. Number")):($("#"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_AREA_CODE").val(c.phones[i].PHONE_AREA_CODE),$("#GROUP_"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER_INTL").hide(),$("#"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER").val(c.phones[i].PHONE_NUMBER),$("#GROUP_"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER").show(),$("#GROUP_"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_NUMBER_INTL_SWITCH .intl_number_switch").html("Enter International Number")),$("#"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_SEQUENCE_NO").val(c.phones[i].PHONE_SEQUENCE_NO),$("#"+a+"_PHONE_"+c.phones[i].PHONE_CODE+"_CARRIER").val(c.phones[i].PHONE_CARRIER)},error:function(a,b,c){}}),$("#"+a+"_MODAL").modal("show")}function submitModal(a,b){if(formValidate(a),showMainError)return window.scrollTo(0,0),$("#"+a+"_MODAL").animate({scrollTop:0},"fast"),$("#"+a+"_MODAL_ERROR").show(),!1;if(0==b.length)$("#"+a+"_MODAL").hide(),$("#"+a+"_CLOSE_BUTTON").trigger("click"),$("#ERROR_MODAL").modal("show");else{if(!(checkNum(a)>=totalAllowed(a))){$("#"+a+"_MODAL_ERROR").hide(),$(".alert_danger").hide();var c=$("#"+a+"_PARENT_PPID").val(),d=$("#"+a+"_PREF_FIRST_NAME").val()+" "+$("#"+a+"_PREF_LAST_NAME").val();formData='{"PIDM" : "'+b+'",',0==c?formData+='"PPID" : null,':formData=formData+'"PPID" :  "'+c+'",',formData=formData+'"DATA" : "'+a+'","MODE" : "WRITE",';for(var e=["DEMO","EMAIL","ADDRESS"],f=0;f<e.length;f++)"DEMO"==e[f]?"PARENT"==a?formData+='"parent" : {':formData+='"contact" : {':formData=formData+'"'+e[f].toLowerCase()+'": {',x=0,$("."+a+"_"+e[f]+"_FIELD").each(function(){if($(this).is(":visible")||$(this).attr("name","PECI_EMAIL_CODE")&&"EMAIL"==e[f]){var b=$(this).val(),c=$(this).attr("name");if("DEMO"!=e[f])var c=c.replace("PARENT_",""),c=c.replace("EMERG_",""),c=c.replace("CONTACT_","");else var c=c.replace("CONTACT","EMERG");if("DEPENDENT"==c)if(dependent_field="form#"+a+" #DEPENDENT",$(dependent_field).is(":checked"))var b="Y";else var b="N";if("EMERG_NO_CELL_PHONE"==c.substr(c.length-19))if(c="EMERG_NO_CELL_PHONE",$(this).is(":checked"))var b="Y";else var b="N";0==x?x+=1:formData+=",",addToFormData(b,c)}}),formData+="},";formData+='"phones": [ {';for(var g=["CP","MA","BU"],h=0;h<g.length;h++){"CP"!=g[h]&&(formData+="},{");var i=$("#"+a+"_PHONE_"+g[h]+"_SEQUENCE_NO").val();console.log("phone_sequence_no: "+i);var j=$("#"+a+"_PHONE_"+g[h]+"_CODE").val();if("EP"==g[h])if($("#"+a+"_EMERG_NO_CELL_PHONE").is(":checked"))if($("#GROUP_"+a+"_PHONE_EMERGENCY_NUMBER_INTL").is(":visible"))var k="",l="",m=$("#"+a+"_PHONE_EMERGENCY_NUMBER_INTL").val();else var k=$("#"+a+"_PHONE_EMERGENCY_AREA_CODE").val(),l=$("#"+a+"_PHONE_EMERGENCY_NUMBER").val(),m="";else var k="",l="",m="",n="";else if("CP"==g[h])if($("#"+a+"_EMERG_NO_CELL_PHONE").is(":checked"))var k="",l="",m="",n="";else if($("#GROUP_"+a+"_PHONE_"+g[h]+"_NUMBER_INTL").is(":visible"))var k="",l="",m=$("#"+a+"_PHONE_"+g[h]+"_NUMBER_INTL").val();else var k=$("#"+a+"_PHONE_"+g[h]+"_AREA_CODE").val(),l=$("#"+a+"_PHONE_"+g[h]+"_NUMBER").val(),m="";else if($("#GROUP_"+a+"_PHONE_"+g[h]+"_NUMBER_INTL").is(":visible"))var k="",l="",m=$("#"+a+"_PHONE_"+g[h]+"_NUMBER_INTL").val();else var k=$("#"+a+"_PHONE_"+g[h]+"_AREA_CODE").val(),l=$("#"+a+"_PHONE_"+g[h]+"_NUMBER").val(),m="";var n=$("#"+a+"_PHONE_"+g[h]+"_CARRIER").val();0==i.length?formData+='"PHONE_SEQUENCE_NO" : null,':formData=formData+'"PHONE_SEQUENCE_NO" : "'+i+'",',formData=formData+'"PHONE_AREA_CODE" : "'+k+'",',formData=formData+'"PHONE_NUMBER" : "'+l+'",',formData=formData+'"PHONE_CODE" : "'+j+'",',formData=formData+'"PHONE_NUMBER_INTL" : "'+m+'",',void 0==n||0==i.length?formData+='"CELL_PHONE_CARRIER" : null':formData=formData+'"CELL_PHONE_CARRIER" : "'+n+'"',$("#"+a+"_PHONE_"+g[h]+"_SEQUENCE_NO").val("")}return $("#"+a+"_PHONE_EMR_SEQUENCE_NO").val(""),formData+="}]",formData+="}",d.length>1&&0!=b.length?$.ajax({type:"POST",url:ajaxurl,data:formData,dataType:"json",contentType:"application/json",success:function(b){0==c?(checkNum("CONTACT")<totalAllowed("CONTACT")?addToList(a,d,b.PARENT_PPID,1):addToList(a,d,b.PARENT_PPID,0),"PARENT"==a&&checkNum("CONTACT")<totalAllowed("CONTACT")&&promoteParent(b.PARENT_PPID,d)):($("#PARENT_LIST #parent_"+c+" .contact-name").html("<strong>"+d+"</strong>"),$("#CONTACT_LIST #emr_contact_"+c+" .contact-name").html("<strong>"+d+"</strong>")),$("#PARENT_PARENT_PPID").val(0),$("#CONTACT_PARENT_PPID").val(0),resetIntlModalNumbers(),getAlertNumbers(),$("form#PARENT #GROUP_PARENT_ADDRESS_TO_USE").show(),$("form#CONTACT #GROUP_CONTACT_ADDRESS_TO_USE").show(),$(".modal_mobile_phone_check").is(":checked")&&$(".modal_mobile_phone_check").prop("checked",!1).change(),document.getElementById(a).reset(),$("#"+a+"_CLNADDR_RESULTS").hide(),$("#"+a+"_MODAL").hide(),$("#"+a+"_CLOSE_BUTTON").trigger("click"),$("#CONFIRMATION_MODAL").modal("show"),setEmrOrder(),setTimeout(function(){entryCheck()},1500)},error:function(b){return $("#"+a+"_MODAL").hide(),$("#"+a+"_CLOSE_BUTTON").trigger("click"),$("#ERROR_MODAL").modal("show"),!1}}):($("#"+a+"_MODAL").hide(),$("#"+a+"_CLOSE_BUTTON").trigger("click"),$("#ERROR_MODAL").modal("show")),!1}$("#"+a+"_MODAL").hide(),$("#"+a+"_CLOSE_BUTTON").trigger("click"),$("#MAX_"+a+"S_ALLOWED_MODAL").modal()}}function resetIntlModalNumbers(){$(".modal_intl_form_group").each(function(){thisID=$(this).attr("id"),thisHTML=$("#"+thisID+"_SWITCH .modal_intl_number_switch").html(),"Enter U.S. Number"==thisHTML&&$("#"+thisID+"_SWITCH .modal_intl_number_switch").trigger("click")})}function resetPhoneSequenceNo(){for(var a=["PARENT","CONTACT"],b=["CP","EP","MA","BU"],c=0;c<a.length;c++){for(var d=0;d<b.length;d++)$("#"+a[c]+"_PHONE_"+b[d]+"_SEQUENCE_NO").val("");$("#"+a+"_PARENT_PPID").val(0)}}function addToFormData(a,b){return formData=formData+'"'+b+'" : ',0!=a.length?formData=formData+'"'+a+'"':formData+="null",formData}function addToList(a,b,c,d){"PARENT"==a?addParent(a,c,b,d):addContact(a,c,b)}function addParent(a,b,c,d){var e='<div class="panel panel-default PARENT-LISTED" id="parent_'+b+'"><div class="panel-body"><span class="contact-name"><strong>'+c+'</strong></span><a href="#" title="Edit" class="showModal" data-ppid="'+b+'" data-modal-type="PARENT"><span aria-hidden="true" class="glyphicon glyphicon-pencil" ></span></a>&nbsp;<a href="#" title="Delete" class="deleteModal" data-name="'+c+'" data-ppid="'+b+'"  data-modal-type="PARENT"><span aria-hidden="true" class="glyphicon glyphicon-trash"></span></a><span class="emergency_contact_switch">&nbsp;Emergency Contact: <input type="checkbox" name="PARENT" checked="checked" class="bootstrap-switch parent-bootstrap-switch" data-ppid="'+b+'" data-off-text="No" data-on-text="Yes"></span></div></div>';$("#PARENT_LIST").append(e);var f=$(".parent-bootstrap-switch:checked").length;1==f?$("#PARENT_LIST #parent_"+b+" .bootstrap-switch").bootstrapSwitch("disabled",!0):f>1&&$(".parent-bootstrap-switch:checked").each(function(){$(this).bootstrapSwitch("disabled",!1)}),d||$("#PARENT_LIST #parent_"+b+" .parent-bootstrap-switch").bootstrapSwitch("state",!1),$("#PARENT_LIST #parent_"+b+" .bootstrap-switch").on("switchChange.bootstrapSwitch",function(a,d){emergencySwitchToggle(b,c,a,d)}),$("#PARENT_LIST #parent_"+b).on("click",".showModal",function(){populateModal("PARENT",b)}),$("#PARENT_LIST #parent_"+b).on("click",".deleteModal",function(){showDeleteModal("PARENT",b,c)})}function addParentAsContact(a,b,c){var d='<li class="panel panel-info CONTACT-LISTED" id="emr_contact_'+b+'"><div class="panel-heading"><span aria-hidden="true" class="glyphicon glyphicon-move" ></span> Emergency Contact - Drag to reorder</div><div class="panel-body"><span class="contact-name"><strong>'+c+'</strong></span> &nbsp; <a href="#" title="Edit"  class="showModal" data-ppid="'+b+'" data-modal-type="CONTACT"><span aria-hidden="true" class="glyphicon glyphicon-pencil" ></span></a></div></li>';$("#CONTACT_LIST").append(d),$("#CONTACT_LIST #emr_contact_"+b).on("click",".showModal",function(){populateModal("CONTACT",b)})}function addContact(a,b,c){var d='<li class="panel panel-info CONTACT-LISTED" id="emr_contact_'+b+'"><div class="panel-heading"><span aria-hidden="true" class="glyphicon glyphicon-move" ></span> Emergency Contact - Drag to reorder</div><div class="panel-body"><span class="contact-name"><strong>'+c+'</strong></span> &nbsp; <a href="#" title="Edit"  class="showModal" data-ppid="'+b+'" data-modal-type="CONTACT"><span aria-hidden="true" class="glyphicon glyphicon-pencil" ></span></a>&nbsp;<a href="#" title="Delete" class="deleteModal" data-name="'+c+'" data-ppid="'+b+'"  data-modal-type="CONTACT"><span aria-hidden="true" class="glyphicon glyphicon-trash"></span></a></div></li>';$("#CONTACT_LIST").append(d),$("#CONTACT_LIST #emr_contact_"+b).on("click",".showModal",function(){populateModal("CONTACT",b)}),$("#CONTACT_LIST #emr_contact_"+b).on("click",".deleteModal",function(){showDeleteModal("CONTACT",b,c)})}function addCampusAlertNumber(a,b,c){if("STUDENT"==c)if($("#STUDENT_EP_NUMBER").length)$("#STUDENT_EP_NUMBER").val(a),$("#STUDENT_EP_NUMBER_TEXT").html("&nbsp;"+a+"&nbsp;("+b+" - Your phone number will always be contacted)");else{var d='<li class="list-unstyled grayed-out alert_phone_number"><input type="checkbox" value="'+a+'" name="fields[25]" checked="checked" disabled="disabled" id="STUDENT_EP_NUMBER"><span id="STUDENT_EP_NUMBER_TEXT">&nbsp;&nbsp;'+a+"&nbsp;("+b+" - Your phone number will always be contacted)</span></li>";$("#CAMPUS_ALERT_NUMBERS").prepend(d)}else{var d='<li class="list-unstyled alert_phone_number"><input type="checkbox" value="'+a+'" name="fields[25]">&nbsp;'+a+"&nbsp;("+b+")</li>";$("#CAMPUS_ALERT_NUMBERS").append(d)}}function emergencyNumberToggle(a,b){b?($("#GROUP_"+a+"_PHONE_EMERGENCY_NUMBER").show(),$("#"+a+"_EMERGENCY_PHONE").addClass("ccreq"),$("#GROUP_"+a+"_PHONE_EMERGENCY_NUMBER_INTL_SWITCH").show(),$("form#"+a+" PHONE_CP_NUMBER_ERROR").hide(),$("#GROUP_"+a+"_PHONE_CP_NUMBER .required").hide(),$("#GROUP_"+a+"_PHONE_CP_NUMBER_INTL .required").hide(),$("#"+a+"_PHONE_CP_AREA_CODE").removeClass("ccreq"),$("#"+a+"_PHONE_CP_NUMBER").removeClass("ccreq"),$("#"+a+"_PHONE_CP_NUMBER_INTL").removeClass("ccreq"),$("#"+a+"_PHONE_EMERGENCY_AREA_CODE").addClass("ccreq"),$("#"+a+"_PHONE_EMERGENCY_NUMBER").addClass("ccreq"),$("#GROUP_"+a+"_PHONE_CARRIER .required").hide(),"STUDENT"==a&&($("#paragraph_alert_text_check").hide(),$("#group_alert_text_check").hide(),$("#paragraph_tty_device_check").html("If your emergency phone is a TTY device (for the hearing impaired) please indicate below:"))):($("#GROUP_"+a+"_PHONE_EMERGENCY_NUMBER").hide(),$("#GROUP_"+a+"_PHONE_EMERGENCY_NUMBER_INTL").hide(),$("#"+a+"_EMERGENCY_PHONE").removeClass("ccreq"),$("#GROUP_"+a+"_PHONE_EMERGENCY_NUMBER_INTL_SWITCH").hide(),$("#GROUP_"+a+"_PHONE_CP_NUMBER .required").show(),$("#"+a+"_PHONE_CP_AREA_CODE").addClass("ccreq"),$("#"+a+"_PHONE_CP_NUMBER").addClass("ccreq"),$("#"+a+"_PHONE_EMERGENCY_AREA_CODE").removeClass("ccreq"),$("#"+a+"_PHONE_EMERGENCY_NUMBER").removeClass("ccreq"),$("form#"+a+" #GROUP_PHONE_CARRIER .required").show(),"STUDENT"==a&&($("#paragraph_alert_text_check").show(),$("#group_alert_text_check").show(),$("#paragraph_tty_device_check").html("If your mobile phone is a TTY device (for the hearing impaired) please indicate below:")))}function emergencySwitchToggle(a,b,c,d){var f=!1,g=$(".parent-bootstrap-switch:checked").length;0==d?(g<1?0==deanExceptionDate.length?$(this).bootstrapSwitch("state",!0):f=!0:1==g?0==deanExceptionDate.length?($(".parent-bootstrap-switch:checked").bootstrapSwitch("disabled",!0),f=!0):f=!0:($(".parent-bootstrap-switch").bootstrapSwitch("disabled",!1),f=!0),f&&($("#emr_contact_"+a).hide(),performDelete(a,"CONTACT")),setEmrOrder()):0==$("#emr_contact_"+a).length&&(g<1?0==deanExceptionDate.length&&$(this).bootstrapSwitch("state",!0):1==g?0==deanExceptionDate.length&&$(".parent-bootstrap-switch:checked").bootstrapSwitch("disabled",!0):$(".parent-bootstrap-switch").bootstrapSwitch("disabled",!1),checkNum("CONTACT")>=totalAllowed("CONTACT")&&($("#parent_"+a+" .parent-bootstrap-switch").bootstrapSwitch("state",!1),$("#MAX_CONTACTS_ALLOWED_MODAL").modal()),promoteParent(a,b))}function modalMobilePhoneWarning(a,b){b?($("#"+a+"_PHONE_MOBILE_PHONE_WARNING").show(),$("#GROUP_"+a+"_PHONE_CP_NUMBER .required").hide(),$("#GROUP_"+a+"_PHONE_CP_NUMBER_INTL .required").hide(),$("#"+a+"_PHONE_CP_AREA_CODE").removeClass("ccreq"),$("#"+a+"_PHONE_CP_NUMBER").removeClass("ccreq"),$("#"+a+"_PHONE_CP_NUMBER_INTL").removeClass("ccreq")):($("#"+a+"_PHONE_MOBILE_PHONE_WARNING").hide(),$("#GROUP_"+a+"_PHONE_CP_NUMBER .required").show(),$("#"+a+"_PHONE_CP_AREA_CODE").addClass("ccreq"),$("#"+a+"_PHONE_CP_NUMBER").addClass("ccreq"))}function promoteParent(a,b){$.ajax({type:"POST",url:ajaxurl,data:JSON.stringify({PIDM:student_PIDM,PPID:a,DATA:"PARENT",MODE:"PROMOTE"}),datatype:"json",contentType:"application/json",success:function(c){0==$("#emr_contact_"+a).length&&addParentAsContact("PARENT",a,b),getAlertNumbers(),setEmrOrder()},error:function(a,b,c){}})}function getAlertNumbers(){$.ajax({type:"POST",url:ajaxurl,data:JSON.stringify({PIDM:student_PIDM,PPID:null,DATA:"PHONES",MODE:"READ"}),datatype:"json",contentType:"application/json",success:function(a){for(a.phones.length>0&&$(".NON-STUDENT-EP-NUMBER").remove(),i=0;i<a.phones.length;i++){var b=a.phones[i].PHONE_CODE;if("EP"!=b){var c=a.phones[i].PHONE_AREA_CODE,d=a.phones[i].PHONE_NUMBER,e=a.phones[i].PHONE_NUMBER_INTL,g=(a.phones[i].PHONE_SEQUENCE_NO,a.phones[i].Pref_Name);if(null!=e)if(e.length>0)var h=e;else var h=""+c+d;else var h=""+c+d;if($.inArray(h,checked_phone_numbers)==-1)var j='<li class="list-unstyled NON-STUDENT-EP-NUMBER alert_phone_number"><input type="checkbox" value="'+h+'" name="fields[25]" onchange="alertNumberReview(this)">&nbsp;'+h+"&nbsp;("+g+")</li>";else var j='<li class="list-unstyled NON-STUDENT-EP-NUMBER alert_phone_number"><input type="checkbox" checked="checked" value="'+h+'" name="fields[25]" onchange="alertNumberReview(this)">&nbsp;'+h+"&nbsp;("+g+")</li>";$("#CAMPUS_ALERT_NUMBERS").append(j)}}},error:function(a,b,c){}})}function setEmrOrder(){var a=$(".draggablePanelList"),b="",c=0;$(".panel",a).each(function(a,d){var e=$(d);if(e.is(":visible")){var g=(e.index(),e.attr("id").replace("emr_contact_",""));g=g.replace("parent_",""),0!=c&&(b+=","),b+=g,c+=1}}),$("#emr_order").val(b)}$(document).ready(function(){$("#noscriptmsg").hide(),checked_phone_numbers=$("input[name=checked_phone_numbers]").map(function(a,b){return b.value}),entryCheck(),$("[data-toggle=popover]").popover(),$("[data-toggle=tooltip]").tooltip(),$("#CONTACT_LIST li").each(function(){var a=$(this).attr("id");shortenedID=a.replace("emr_contact_",""),$("#PARENT_LIST #parent_"+shortenedID).length&&($("#parent_"+shortenedID+" .parent-bootstrap-switch").bootstrapSwitch("state",!0),$("#"+a+" .deleteModal").remove())}),emr_switch_count=$(".parent-bootstrap-switch:checked").length,1==emr_switch_count&&0==deanExceptionDate.length&&$(".parent-bootstrap-switch:checked").bootstrapSwitch("disabled",!0),$("mobile_phone_check").each(function(){if(this.checked){var a=$(this).closest("form").attr("id");emergencyNumberToggle(a,1)}}),$(".mobile_phone_check").change(function(){var a=$(this).closest("form").attr("id"),b=this.checked?1:0;emergencyNumberToggle(a,b)}),$(".modal_mobile_phone_check").each(function(){if(this.checked){var a=$(this).closest("form").attr("id");modalMobilePhoneWarning(a,1)}}),$(".modal_mobile_phone_check").change(function(){var a=$(this).closest("form").attr("id"),b=this.checked?1:0;modalMobilePhoneWarning(a,b)}),$(".intl_number_switch").click(function(){var a=$(this).closest("form").attr("id"),b=$(this).attr("data-type"),c="#GROUP_"+a+"_PHONE_"+b+"_NUMBER_INTL",d="#GROUP_"+a+"_PHONE_"+b+"_NUMBER";"none"==$(c).css("display")?($(d).hide(),$(c).show(),"STUDENT"==a&&($("#"+a+"_PHONE_"+b+"_AREA_CODE").val(""),$("#"+a+"_PHONE_"+b+"_NUMBER").val("")),$(this).html("Enter U.S. Number"),"CP"!=b&&"EMERGENCY"!=b||($("#"+a+"_PHONE_"+b+"_NUMBER_INTL").addClass("ccreq"),$("#"+a+"_PHONE_"+b+"_AREA_CODE").removeClass("ccreq"),$("#"+a+"_PHONE_"+b+"_NUMBER").removeClass("ccreq"))):($(d).show(),$(c).hide(),"STUDENT"==a&&$("#"+a+"_PHONE_"+b+"_NUMBER_INTL").val(""),$(this).html("Enter International Number"),"CP"!=b&&"EMERGENCY"!=b||($("#"+a+"_PHONE_"+b+"_NUMBER_INTL").removeClass("ccreq"),$("#"+a+"_PHONE_"+b+"_AREA_CODE").addClass("ccreq"),$("#"+a+"_PHONE_"+b+"_NUMBER").addClass("ccreq"))),"STUDENT"==a&&addCampusAlertNumber($(this).val(),student_name,"STUDENT")}),$(".student_phone_field").focusout(function(){var a=$(this).attr("data-phone-type"),b=$(this).attr("data-phone-intl");if(1==b)var c=$("#STUDENT_PHONE_"+a+"_NUMBER_INTL").val();else{var c=$("#STUDENT_PHONE_"+a+"_AREA_CODE").val()+""+$("#STUDENT_PHONE_"+a+"_NUMBER").val();addCampusAlertNumber(c,student_name,"STUDENT")}}),$('input[name="PARENT"]').on("switchChange.bootstrapSwitch",function(a,b){var c=$(this).attr("data-ppid"),d=$("#parent_"+c+" .contact-name").html();emergencySwitchToggle(c,d,a,b)}),$(".country_field").change(function(){var a=$(this).closest("form").attr("id"),b=$(this).val();countryProvinceDisplay(a,b)}),$(".showModal").click(function(){modal_type=$(this).attr("data-modal-type"),ppid=$(this).attr("data-ppid"),populateModal(modal_type,ppid)}),$(".deleteModal").click(function(){var a=$(this).attr("data-modal-type"),b=$(this).attr("data-ppid"),c=$(this).attr("data-name");showDeleteModal(a,b,c)}),$(".num_only").keypress(function(a){if(/^\d+$/.test(a.key));else{var b=a.which?a.which:a.keyCode;if("Delete"==a.key);else if(b>31&&(b<48||b>57))return!1}});var a=/[\w\s\.\d\t\r\@\,x16\-\#\'\:\+\(\)\\\//]/,b=/[\w\s\.\d\t\r\,x16\-\']/;$("input").keypress(function(c){if(thisID=$(this).attr("id"),$(this).hasClass("num_only")||"email"==$(this).attr("type"));else if($(this).hasClass("address_field")||$(this).hasClass("intl_number")){if(!a.test(c.key))return $("#"+thisID+"_foreign").length||$(this).parent().append('<span id="'+thisID+'_foreign" class="text-danger">Please do not enter foreign or special characters</span>'),c.preventDefault(),!1;$("#"+thisID+"_foreign").remove()}else{if(!b.test(c.key))return $("#"+thisID+"_foreign").length||$(this).parent().append('<span id="'+thisID+'_foreign" class="text-danger">Please do not enter foreign or special characters</span>'),c.preventDefault(),!1;$("#"+thisID+"_foreign").remove()}}),$(".area_code").on("input",function(){if($(this).val().length==$(this).attr("maxlength")){var a=$(this).closest("form").find(":input");a.eq(a.index(this)+1).focus()}}),$("#CONTACT_MODAL").on("hidden.bs.modal",function(){document.getElementById("CONTACT").reset(),$(".modal_mobile_phone_check").is(":checked")&&$(".modal_mobile_phone_check").prop("checked",!1).change(),resetIntlModalNumbers(),resetPhoneSequenceNo(),$("#CONTACT_PARENT_PPID").val(0),
$("form#CONTACT #GROUP_CONTACT_ADDRESS_TO_USE").show(),$("#CONTACT_CLNADDR_RESULTS").hide()}),$("#PARENT_MODAL").on("hidden.bs.modal",function(){document.getElementById("PARENT").reset(),$(".modal_mobile_phone_check").is(":checked")&&$(".modal_mobile_phone_check").prop("checked",!1).change(),resetIntlModalNumbers(),resetPhoneSequenceNo(),$("#PARENT_PARENT_PPID").val(0),$("form#PARENT #GROUP_PARENT_ADDRESS_TO_USE").show(),$("#PARENT_CLNADDR_RESULTS").hide()}),$("#CONTACT_MODAL, #PARENT_MODAL").on("shown.bs.modal",function(){""==$("#STUDENT_ADDR_STREET_LINE1").val()&&($("form#PARENT #GROUP_PARENT_ADDRESS_TO_USE").hide(),$("form#CONTACT #GROUP_CONTACT_ADDRESS_TO_USE").hide())}),$("#ADD_PARENT,#ADD_CONTACT").click(function(){resetPhoneSequenceNo()}),$("#PARENT_MODAL, #CONTACT_MODAL, #DELETE_MODAL").on("hidden.bs.modal",function(){$("#PARENT_MODAL .alert-danger, #CONTACT_MODAL .alert-danger, #DELETE_MODAL .alert-danger, #PARENT_MODAL .alert-warning, #CONTACT_MODAL .alert-warning").hide(),$("#PARENT_MODAL .form-group, #CONTACT_MODAL .form-group, #DELETE_MODAL .form-group").removeClass("has-error")}),$("input.alert_phone_number").on("change",function(){alertNumberReview($(this))}),$(".address_to_use_checkbox").change(function(){var a=$(this).attr("name"),b=$(this).attr("data-type"),c=$("#SELECT_"+a).val(),d=$("#STUDENT_ADDR_NATN_CODE").val();$(this).prop("checked")?"STUDENT"==c&&(countryProvinceDisplay(b,d),$(".STUDENT_ADDRESS_FIELD").each(function(){if($(this).is(":visible")){var a=$(this).attr("id"),a=a.replace("STUDENT",""),c=$(this).val();$("#"+b+a).val(c)}})):"STUDENT"==c&&(countryProvinceDisplay(b,"US"),$(".STUDENT_ADDRESS_FIELD").each(function(){if($(this).is(":visible")){var a=$(this).attr("id"),a=a.replace("STUDENT","");$(this).val();$("#"+b+a).val("")}}))})});